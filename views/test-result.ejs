<%- include('partials/header', { title: 'Результат теста' }) %>

<div class="row">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h3 class="card-title mb-0">Результат теста</h3>
            </div>
            <div class="card-body">
                <h4><%= result.Test.title %></h4>
                <p><strong>Балл:</strong> <%= result.score %>/<%= result.totalQuestions %></p>
                <p><strong>Процент:</strong> <%= Math.round((result.score / result.totalQuestions) * 100) %>%</p>
                <p><strong>Дата прохождения:</strong> <%= new Date(result.completedAt).toLocaleString('ru-RU') %></p>
                <% if (result.timeSpent) { %>
                    <p><strong>Время:</strong> <%= Math.floor(result.timeSpent / 60) %> мин <%= result.timeSpent % 60 %> сек</p>
                <% } %>

                <hr>

                <h5>Детали ответов:</h5>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Вопрос</th>
                                <th>Ваш ответ</th>
                                <th>Результат</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% userAnswers.forEach(userAnswer => { %>
                                <tr class="<%= userAnswer.isCorrect ? 'table-success' : 'table-danger' %>">
                                    <td><%= userAnswer.Question ? userAnswer.Question.text : 'Вопрос удален' %></td>
                                    <td>
                                        <% if (userAnswer.Answer) { %>
                                            <%= userAnswer.Answer.text %>
                                        <% } else if (userAnswer.userTextAnswer) { %>
                                            <%= userAnswer.userTextAnswer %>
                                        <% } else { %>
                                            Не отвечено
                                        <% } %>
                                    </td>
                                    <td>
                                        <% if (userAnswer.isCorrect) { %>
                                            <span class="badge bg-success">Правильно</span>
                                        <% } else { %>
                                            <span class="badge bg-danger">Неправильно</span>
                                        <% } %>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>

                <div class="mt-3">
                    <a href="/tests/statistics" class="btn btn-primary">Вернуться к статистике</a>
                    <a href="/tests/emulator" class="btn btn-secondary">К эмулятору</a>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('partials/footer') %>






