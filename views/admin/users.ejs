<%- include('../partials/header', { title: 'Управление пользователями' }) %>

<div class="row mb-4">
    <div class="col-12">
        <h2 class="mb-0"><i class="bi bi-people-fill text-primary"></i> Пользователи</h2>
    </div>
</div>

<% if (typeof query !== 'undefined' && query.success) { %>
    <div class="alert alert-success alert-dismissible fade show">
        <%= query.success %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
<% } %>

<% if (typeof query !== 'undefined' && query.error) { %>
    <div class="alert alert-danger alert-dismissible fade show">
        <%= query.error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
<% } %>

<div class="card shadow-lg">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Никнейм</th>
                        <th>Email</th>
                        <th>Роль</th>
                        <th>Подписка</th>
                        <th>Регистрация</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user => { %>
                        <tr>
                            <td><%= user.id %></td>
                            <td><strong><%= user.nickname %></strong></td>
                            <td><%= user.email %></td>
                            <td>
                                <% if (user.isAdmin) { %>
                                    <span class="badge bg-danger">Администратор</span>
                                <% } else if (user.isModerator) { %>
                                    <span class="badge bg-warning">Модератор</span>
                                <% } else { %>
                                    <span class="badge bg-secondary">Пользователь</span>
                                <% } %>
                            </td>
                            <td>
                                <% if (user.isSubscribed) { %>
                                    <span class="badge bg-success">Активна</span>
                                <% } else { %>
                                    <span class="badge bg-secondary">Нет</span>
                                <% } %>
                            </td>
                            <td><%= new Date(user.createdAt).toLocaleDateString('ru-RU') %></td>
                            <td>
                                <div class="btn-group" role="group">
                                    <form method="POST" action="/admin/users/<%= user.id %>/moderator" class="d-inline">
                                        <button type="submit" class="btn btn-sm <%= user.isModerator ? 'btn-warning' : 'btn-outline-warning' %>" 
                                                title="<%= user.isModerator ? 'Снять права модератора' : 'Назначить модератором' %>">
                                            <i class="bi bi-shield-check"></i>
                                        </button>
                                    </form>
                                    <form method="POST" action="/admin/users/<%= user.id %>/admin" class="d-inline">
                                        <button type="submit" class="btn btn-sm <%= user.isAdmin ? 'btn-danger' : 'btn-outline-danger' %>"
                                                title="<%= user.isAdmin ? 'Снять права администратора' : 'Назначить администратором' %>"
                                                <%= user.id === currentUserId ? 'disabled' : '' %>>
                                            <i class="bi bi-shield-fill"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="/admin" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Назад в панель
    </a>
</div>

<%- include('../partials/footer') %>

