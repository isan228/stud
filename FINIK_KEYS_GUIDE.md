# Инструкция по генерации ключей для Finik Payment System

## Что такое ключи?

**Приватный ключ (закрытый)** - секретный ключ, который:
- Хранится ТОЛЬКО на вашем сервере
- Используется для подписи запросов к Finik
- НИКОГДА не должен передаваться третьим лицам
- Добавляется в `.env` как `FINIK_PRIVATE_KEY_PEM`

**Публичный ключ (открытый)** - открытый ключ, который:
- Отправляется в Finik для проверки ваших подписей
- Может быть публичным (не секретный)
- Используется Finik для верификации ваших запросов
- Добавляется в `.env` как `FINIK_PUBLIC_KEY_BETA` или `FINIK_PUBLIC_KEY_PROD`

## Генерация ключей

### Вариант 1: На сервере (Linux)

```bash
# Подключитесь к серверу
ssh root@ваш_сервер_IP

# Перейдите в директорию проекта
cd ~/stud

# Сделайте скрипт исполняемым
chmod +x generate_finik_keys.sh

# Запустите генерацию
./generate_finik_keys.sh
```

### Вариант 2: Локально (Windows)

```powershell
# Если у вас установлен OpenSSL
powershell -ExecutionPolicy Bypass -File generate_finik_keys.ps1

# Или через WSL (Windows Subsystem for Linux)
wsl bash generate_finik_keys.sh
```

### Вариант 3: Вручную (любая система)

```bash
# Генерация приватного ключа
openssl genrsa -out finik_private.pem 2048

# Генерация публичного ключа из приватного
openssl rsa -in finik_private.pem -pubout > finik_public.pem
```

## Что делать после генерации

### 1. Приватный ключ (finik_private.pem)

**На сервере:**

```bash
# Просмотрите содержимое
cat finik_private.pem

# Добавьте в .env (в одну строку с \n для переносов)
# Или используйте скрипт add_finik_key_to_env.sh
```

**Формат в .env:**
```env
FINIK_PRIVATE_KEY_PEM="-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCQUES0N9EBSpCW\n...\n-----END PRIVATE KEY-----"
```

### 2. Публичный ключ (finik_public.pem)

**Просмотрите содержимое:**
```bash
cat finik_public.pem
```

**Скопируйте ВСЁ содержимое, включая:**
```
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
...
-----END PUBLIC KEY-----
```

**Отправьте этот ключ представителям Finik** (по email или через их систему)

### 3. Публичные ключи от Finik

После того, как вы отправите свой публичный ключ в Finik, они предоставят вам их публичные ключи:

- **Beta окружение** - добавьте в `.env` как `FINIK_PUBLIC_KEY_BETA`
- **Production окружение** - добавьте в `.env` как `FINIK_PUBLIC_KEY_PROD`

Эти ключи уже есть в документации Finik и в вашем `.env` файле.

## Безопасность

⚠️ **ВАЖНО:**

1. **Приватный ключ НИКОГДА не должен:**
   - Публиковаться в репозитории Git
   - Передаваться по незащищенным каналам
   - Храниться в открытом виде
   - Показываться третьим лицам

2. **Публичный ключ:**
   - Можно безопасно передавать
   - Можно публиковать
   - Не является секретным

3. **Рекомендации:**
   - Храните приватный ключ только на сервере
   - Используйте `.env` файл (который в `.gitignore`)
   - Регулярно проверяйте безопасность сервера
   - Если ключ скомпрометирован - сгенерируйте новый

## Проверка ключей

После генерации проверьте ключи:

```bash
# Проверка приватного ключа
openssl rsa -in finik_private.pem -check

# Просмотр информации о ключе
openssl rsa -in finik_private.pem -text -noout

# Проверка публичного ключа
openssl rsa -pubin -in finik_public.pem -text -noout
```

## Где находятся ключи?

- **На сервере:** `~/stud/keys/finik_private.pem` и `~/stud/keys/finik_public.pem`
- **В .env:** Приватный ключ хранится как переменная `FINIK_PRIVATE_KEY_PEM`
- **В Finik:** Ваш публичный ключ хранится у них для верификации

## Если ключ скомпрометирован

Если приватный ключ был скомпрометирован:

1. Сгенерируйте новую пару ключей
2. Отправьте новый публичный ключ в Finik
3. Обновите `FINIK_PRIVATE_KEY_PEM` в `.env`
4. Перезапустите приложение

