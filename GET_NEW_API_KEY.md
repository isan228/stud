# Инструкция по получению нового API ключа от Finik

## Шаг 1: Генерация новой пары ключей

### На сервере (Linux):

```bash
cd ~/stud
chmod +x generate_new_finik_keys.sh
./generate_new_finik_keys.sh
```

### Локально (Windows):

```powershell
# Через PowerShell (если установлен OpenSSL)
powershell -ExecutionPolicy Bypass -File generate_new_finik_keys.ps1

# Или через WSL
wsl bash generate_new_finik_keys.sh
```

## Шаг 2: Просмотр публичного ключа

### На сервере:

```bash
cat keys/finik_public_new.pem
```

### Локально (Windows):

```powershell
Get-Content keys/finik_public_new.pem
```

**Скопируйте ВЕСЬ публичный ключ**, включая строки:
```
-----BEGIN PUBLIC KEY-----
...
-----END PUBLIC KEY-----
```

## Шаг 3: Отправка публичного ключа в Finik

Отправьте публичный ключ в Finik через:
- Email (указанный в документации)
- Личный кабинет Finik
- Техническую поддержку

**Сообщение для Finik:**

```
Здравствуйте!

Я хочу получить новый API ключ для интеграции с Finik Payment System.

Мой публичный ключ:

-----BEGIN PUBLIC KEY-----
[вставьте сюда публичный ключ]
-----END PUBLIC KEY-----

Пожалуйста, предоставьте мне:
1. Новый API ключ (x-api-key)
2. Подтверждение Account ID (если необходимо)

Спасибо!
```

## Шаг 4: Получение нового API ключа

После получения нового API ключа от Finik:

### На сервере:

1. **Добавьте новый приватный ключ в .env:**
   ```bash
   cd ~/stud
   chmod +x add_new_finik_key_to_env.sh
   ./add_new_finik_key_to_env.sh
   ```

2. **Обновите API ключ в .env:**
   ```bash
   nano .env
   # Найдите строку FINIK_API_KEY и замените значение на новый API ключ
   ```

   Или через sed:
   ```bash
   sed -i 's/^FINIK_API_KEY=.*/FINIK_API_KEY=НОВЫЙ_API_КЛЮЧ/' .env
   ```

3. **Перезапустите приложение:**
   ```bash
   pm2 restart stud-platform
   ```

4. **Проверьте работу:**
   ```bash
   node test_finik_payment.js
   ```

## Шаг 5: Проверка соответствия ключей

После обновления ключей проверьте:

```bash
node check_finik_keys_match.js
```

Должно показать:
- ✅ Приватный ключ успешно загружен
- ✅ Публичный ключ извлечен
- ✅ Подпись успешно проверена

## Важно

⚠️ **Безопасность:**
- НЕ публикуйте приватный ключ
- НЕ отправляйте приватный ключ в Finik
- Храните приватный ключ только на сервере
- Публичный ключ можно безопасно передавать

⚠️ **После получения нового API ключа:**
- Обновите `.env` файл на сервере
- Перезапустите приложение
- Протестируйте создание платежа

## Резюме

1. ✅ Сгенерируйте новую пару ключей
2. ✅ Отправьте публичный ключ в Finik
3. ✅ Получите новый API ключ от Finik
4. ✅ Обновите `.env` файл (приватный ключ + API ключ)
5. ✅ Перезапустите приложение
6. ✅ Протестируйте

